<!DOCTYPE html>
<html data-bs-theme="light" lang="en" data-bss-forced-theme="light">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Login - Brand</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="assets/css/Font%20Awesome%205%20Brands.css">
    <link rel="stylesheet" href="assets/css/Font%20Awesome%205%20Free.css">
    <link rel="stylesheet" href="assets/css/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/css/css/untitled.css">
</head>

<body class="bg-gradient-primary">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-9 col-lg-12 col-xl-10">
                <div class="card border-0 shadow-lg o-hidden my-5">
                    <div class="card-body p-0">
                        <div class="row">
                            <div class="col-lg-6 offset-xl-3 align-self-center">
                                <div class="p-5"><img src="assets/img/logoEduca.jpg">
                                    <div class="text-center">
                                        <h4 class="text-dark mb-4">Bienvenido!</h4>
                                    </div>
                                    <form class="user" onsubmit="login(event)">
                                        <div class="mb-3"><input class="form-control form-control-user" type="email" aria-describedby="emailHelp" id="exampleInputEmail" name="email" placeholder="Introduzca correo electr칩nico..."></div>
                                        <div class="mb-3"><input class="form-control form-control-user" type="password" id="exampleInputPassword" name="password" placeholder="Contrase침a"></div>
                                        <div class="mb-3">
                                            <div class="custom-control custom-checkbox small">
                                                <div class="form-check"><input type="checkbox" class="form-check-input custom-control-input" id="formCheck-1"><label class="form-label form-check-label custom-control-label" for="formCheck-1">Recuerdame</label></div>
                                            </div>
                                        </div>
                                        <button class="btn btn-primary d-block btn-user w-100" type="submit">Iniciar Sesion</button>
                                        <hr>
                                    </form>
                                    <div class="text-center"><a class="small" href="forgot-password.html">Has olvidado tu contrase침a?</a></div>
                                    <div class="text-center"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function login(event) {
            event.preventDefault();
            var email = document.getElementById("exampleInputEmail").value;
            var password = document.getElementById("exampleInputPassword").value;
        
            fetch("/users/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({email: email, password: password}),
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    return response.text().then(text => {
                        throw new Error(text); // Lanzamos un error para que entre al catch si no es una respuesta ok
                    });
                }
            })
            .then(data => {
                if (data && data.jwtToken) { // Agregado data && para verificar que data no sea undefined
                    localStorage.setItem('jwtToken', data.jwtToken);
                    window.location.href = "/index.html"; // Redirigir al usuario al index
                } else {
                    alert("No se pudo iniciar sesi칩n correctamente. Por favor, intente de nuevo.");
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert(error.message); // Mostrar el mensaje de error
            });
        }
        

    </script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/js/theme.js"></script>
</body>

</html>
