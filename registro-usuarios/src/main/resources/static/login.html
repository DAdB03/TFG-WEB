<!DOCTYPE html>
<html data-bs-theme="light" lang="en" data-bss-forced-theme="light">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Login - Brand</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&amp;display=swap">
    <link rel="stylesheet" href="assets/css/Font%20Awesome%205%20Brands.css">
    <link rel="stylesheet" href="assets/css/Font%20Awesome%205%20Free.css">
    <link rel="stylesheet" href="assets/css/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/css/css/untitled.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
    <style>
        .input-group .form-control {
            border-right: none;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        .input-group .btn {
            border-left: none;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            border-color: #ced4da;
            color: #495057;
            background-color: #fff;
        }
        .input-group .btn:hover {
            background-color: #e9ecef;
        }
    </style>
</head>

<body class="bg-gradient-primary">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-9 col-lg-12 col-xl-10">
                <div class="card border-0 shadow-lg o-hidden my-5">
                    <div class="card-body p-0">
                        <div class="row">
                            <div class="col-lg-6 offset-xl-3 align-self-center">
                                <div class="p-5"><img src="assets/img/logoEduca.svg" style="width: 100%;">
                                    <div class="text-center">
                                        <h4 class="text-dark mb-4">Bienvenido!</h4>
                                    </div>
                                    <form class="user" onsubmit="login(event)">
                                        <div class="mb-3">
                                            <input class="form-control form-control-user" type="email" aria-describedby="emailHelp" id="exampleInputEmail" name="email" placeholder="Introduzca correo electrónico...">
                                        </div>
                                        <div class="mb-3 input-group">
                                            <input class="form-control form-control-user" type="password" id="exampleInputPassword" name="password" placeholder="Contraseña">
                                            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                        </div>
                                        <div class="mb-3">
                                            <div class="custom-control custom-checkbox small">
                                                <div class="form-check"><input type="checkbox" class="form-check-input custom-control-input" id="formCheck-1"><label class="form-label form-check-label custom-control-label" for="formCheck-1">Recuerdame</label></div>
                                            </div>
                                        </div>
                                        <button class="btn btn-primary d-block btn-user w-100" type="submit">Iniciar Sesion</button>
                                        <hr>
                                    </form>
                                    <div class="text-center" style="padding-top: 15px">
                                        <p id="error" class="error-message"></p>
                                    </div>
                                    <div class="text-center">
                                        <a class="small" href="register.html">Todavia no tiene cuenta? Registrese!</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Load credentials from localStorage if available
            const rememberedEmail = localStorage.getItem("rememberedEmail");
            const rememberedPassword = localStorage.getItem("rememberedPassword");

            if (rememberedEmail && rememberedPassword) {
                document.getElementById("exampleInputEmail").value = rememberedEmail;
                document.getElementById("exampleInputPassword").value = rememberedPassword;
                document.getElementById("formCheck-1").checked = true;
            }
        });

        function login(event) {
            event.preventDefault();
            var email = document.getElementById("exampleInputEmail").value;
            var password = document.getElementById("exampleInputPassword").value;
            var rememberMe = document.getElementById("formCheck-1").checked;

            fetch("/users/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({email: email, password: password}),
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    return response.text().then(text => {
                        throw new Error(text);
                    });
                }
            })
            .then(data => {
                if (data && data.jwtToken) {
                    localStorage.setItem('jwtToken', data.jwtToken);

                    if (rememberMe) {
                        localStorage.setItem("rememberedEmail", email);
                        localStorage.setItem("rememberedPassword", password);
                    } else {
                        localStorage.removeItem("rememberedEmail");
                        localStorage.removeItem("rememberedPassword");
                    }

                    window.location.href = "/index.html";
                } else {
                    alert("No se pudo iniciar sesión correctamente. Por favor, intente de nuevo.");
                }
            })
            .catch((error) => {
                console.error("Error:", error);
                document.getElementById('error').textContent = error.message;
                document.getElementById('error').style.display= "block";
            });
        }

        document.getElementById('togglePassword').addEventListener('click', function (e) {
            const passwordInput = document.getElementById('exampleInputPassword');
            const icon = e.currentTarget.querySelector('i');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye');
            }
        });
    </script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/js/theme.js"></script>
</body>

</html>
